<!DOCTYPE html>
<html>
  <head>
    <title>Meta Quest - Large Scale Edition</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

    <script>
      AFRAME.registerComponent('game-logic', {
        init: function () {
          this.score = 0;
          this.balls = [];
          // WIDER box zone for the bigger box
          this.boxZone = { xMin: -2.5, xMax: 2.5, zMin: -10, zMax: -6 }; 
          this.spawnBalls();
          this.el.sceneEl.addEventListener('xbuttondown', () => { location.reload(); });
        },
        spawnBalls: function() {
          let scene = this.el.sceneEl;
          for (let i = 0; i < 10; i++) {
            let ball = document.createElement('a-sphere');
            // BIGGER BALLS: radius 0.4 instead of 0.15
            ball.setAttribute('radius', '0.4');
            ball.setAttribute('color', 'red');
            ball.setAttribute('position', {
                x: (Math.random() * 6) - 3, 
                y: 2, 
                z: (Math.random() * 6) - 3
            });
            ball.setAttribute('dynamic-body', 'shape: sphere; mass: 5');
            ball.setAttribute('class', 'ball');
            scene.appendChild(ball);
            this.balls.push(ball);
          }
        },
        tick: function () {
          let count = 0;
          this.balls.forEach(ball => {
            let p = ball.object3D.position;
            // Updated win area for the larger box
            if (p.x > -2.5 && p.x < 2.5 && p.z > -10 && p.z < -6 && p.y < 2) count++;
          });
          document.querySelector('#ui-text').setAttribute('value', 'Move balls to box: ' + count + '/10');
        }
      });

      AFRAME.registerComponent('hold-grab', {
        init: function () {
          this.grabbedEl = null;
          this.el.addEventListener('gripdown', this.onGrab.bind(this));
          this.el.addEventListener('gripup', this.onRelease.bind(this));
        },
        onGrab: function () {
          let balls = document.querySelectorAll('.ball');
          let closest = null;
          // BIGGER GRAB RANGE: 0.6 meters so you can grab from further away
          let minDist = 0.6; 

          balls.forEach(ball => {
            let dist = this.el.object3D.position.distanceTo(ball.object3D.position);
            if (dist < minDist) {
              closest = ball;
              minDist = dist;
            }
          });

          if (closest) {
            this.grabbedEl = closest;
            this.grabbedEl.removeAttribute('dynamic-body');
            this.el.object3D.attach(this.grabbedEl.object3D);
            this.grabbedEl.setAttribute('color', 'yellow');
          }
        },
        onRelease: function () {
          if (this.grabbedEl) {
            this.el.sceneEl.object3D.attach(this.grabbedEl.object3D);
            this.grabbedEl.setAttribute('dynamic-body', 'shape: sphere; mass: 5');
            this.grabbedEl.setAttribute('color', 'red');
            this.grabbedEl = null;
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene physics="gravity: -9.8" game-logic>
      <a-assets>
        <img id="grass" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
      </a-assets>

      <a-sky color="#87CEEB"></a-sky>
      <a-plane src="#grass" repeat="20 20" rotation="-90 0 0" width="100" height="100" static-body></a-plane>

      <a-entity id="rig" movement-controls="speed: 0.3" position="0 0 5">
        <a-entity camera position="0 1.6 0" look-controls>
           <a-text id="ui-text" value="Balls: 0/10" position="-1 0.6 -1.5" scale="0.5 0.5 0.5" color="white"></a-text>
        </a-entity>
        
        <a-entity laser-controls="hand: left" hold-grab></a-entity>
        <a-entity laser-controls="hand: right" hold-grab></a-entity>
      </a-entity>

      <a-entity position="0 0 -8">
        <a-box position="0 0 0" width="5" height="0.2" depth="5" color="brown" static-body></a-box>
        <a-box position="-2.5 1 0" width="0.2" height="2" depth="5" color="brown" static-body></a-box>
        <a-box position="2.5 1 0" width="0.2" height="2" depth="5" color="brown" static-body></a-box>
        <a-box position="0 1 -2.5" width="5.2" height="2" depth="0.2" color="brown" static-body></a-box>
        <a-box position="0 1 2.5" width="5.2" height="2" depth="0.2" color="brown" static-body></a-box>
        
        <a-text value="DROP BALLS HERE" position="0 2.5 0" align="center" color="yellow" scale="2 2 2"></a-text>
      </a-entity>

      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="-1 5 2"></a-entity>
    </a-scene>
  </body>
</html>
